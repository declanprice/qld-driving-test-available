import {tabletojson} from 'tabletojson';

const table = '<table role="grid"><thead id="slotSelectionForm:slotTable_head"><tr role="row"><th id="slotSelectionForm:slotTable:j_id_67" class="ui-state-default ui-selection-column" role="columnheader" aria-label="" style="width:16px;text-align:center"><span class="ui-column-title"></span></th><th id="slotSelectionForm:slotTable:j_id_68" class="ui-state-default ui-sortable-column" role="columnheader" aria-label="Available booking time: activate to sort column ascending" tabindex="0" aria-sort="other"><span class="ui-column-title">Available booking time</span><span class="ui-sortable-column-icon ui-icon ui-icon-carat-2-n-s"></span></th><th id="slotSelectionForm:slotTable:j_id_6a" class="ui-state-default ui-sortable-column" role="columnheader" aria-label="Location: activate to sort column ascending" tabindex="0" aria-sort="other"><span class="ui-column-title">Location</span><span class="ui-sortable-column-icon ui-icon ui-icon-carat-2-n-s"></span></th></tr></thead><tbody id="slotSelectionForm:slotTable_data" class="ui-datatable-data ui-widget-content"><tr data-ri="0" data-rk="99654555370700" class="ui-widget-content ui-datatable-even ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:0:startTime">Thursday, 20 March 2025 3:35 PM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="1" data-rk="99654555371900" class="ui-widget-content ui-datatable-odd ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:1:startTime">Tuesday, 25 March 2025 10:25 AM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="2" data-rk="99654555373000" class="ui-widget-content ui-datatable-even ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:2:startTime">Tuesday, 25 March 2025 11:55 AM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="3" data-rk="99654555373300" class="ui-widget-content ui-datatable-odd ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:3:startTime">Tuesday, 25 March 2025 1:10 PM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="4" data-rk="99654555374500" class="ui-widget-content ui-datatable-even ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:4:startTime">Tuesday, 25 March 2025 2:50 PM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="5" data-rk="99654555374800" class="ui-widget-content ui-datatable-odd ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:5:startTime">Tuesday, 25 March 2025 3:35 PM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="6" data-rk="99654555375900" class="ui-widget-content ui-datatable-even ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:6:startTime">Wednesday, 26 March 2025 9:30 AM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="7" data-rk="99705204378900" class="ui-widget-content ui-datatable-odd ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:7:startTime">Wednesday, 26 March 2025 10:25 AM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="8" data-rk="99654555376600" class="ui-widget-content ui-datatable-even ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:8:startTime">Wednesday, 26 March 2025 11:10 AM</label></td><td role="gridcell">Caloundra CSC</td></tr><tr data-ri="9" data-rk="99654555376900" class="ui-widget-content ui-datatable-odd ui-datatable-selectable" role="row" aria-selected="false"><td role="gridcell" style="width:16px;text-align:center" class="ui-selection-column"><div class="ui-radiobutton ui-widget"><div class="ui-helper-hidden-accessible"><input type="radio" name="slotSelectionForm:slotTable_radio"></div><div class="ui-radiobutton-box ui-widget ui-corner-all ui-state-default"><span class="ui-radiobutton-icon ui-icon ui-icon-blank ui-c"></span></div></div></td><td role="gridcell"><label for="slotSelectionForm:slotTable:9:startTime">Wednesday, 26 March 2025 11:55 AM</label></td><td role="gridcell">Caloundra CSC</td></tr></tbody></table>';

export const checkTableForSoonerDate = (dateForCheck, html) => {
    const parsedTable = tabletojson.convert(html);

    const items = parsedTable[0];

    const dates = items.map(i => i['Available booking time']);

    const soonerDates = [];

    for (const date of dates) {
        if (new Date(date).toISOString() < dateForCheck.toISOString()) {
            soonerDates.push(date);
        } else {
            console.log(`(INFO) - not found any date sooner than ${dateForCheck.toISOString()}`);
        }
    }

    if (soonerDates.length > 0) {
        console.log(`(INFO) - found ${soonerDates.length} dates sooner than ${dateForCheck.toISOString()}`);
    }

    return soonerDates;
}

